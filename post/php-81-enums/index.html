<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Перечисления в PHP 8.1 | Сергей Пантелеев</title>
    <meta name="description" content="Перевод статьи про перечисления, которые были добавлены в PHP 8.1">
            <link rel="alternate" hreflang="en" href="https://stitcher.io/blog/php-enums"/>
            <!-- Yandex.Metrika counter -->
        <script type="text/javascript"> (function (m, e, t, r, i, k, a) {
            m[i] = m[i] || function () {(m[i].a = m[i].a || []).push(arguments)}
            m[i].l = 1 * new Date()
            k = e.createElement(t), a = e.getElementsByTagName(t)[0], k.async = 1, k.src = r, a.parentNode.insertBefore(
              k, a)
          })(window, document, 'script', 'https://mc.yandex.ru/metrika/tag.js', 'ym')
          ym(50044507, 'init',
            { clickmap: true, trackLinks: true, accurateTrackBounce: true, webvisor: true }) </script>
        <noscript>
            <div><img src="https://mc.yandex.ru/watch/50044507" style="position:absolute; left:-9999px;" alt=""/></div>
        </noscript> <!-- /Yandex.Metrika counter -->
        <link rel="stylesheet" href="/assets/build/css/main.css">
</head>
<body class="flex flex-col justify-between min-h-screen font-sans antialiased">
<nav aria-labelledby="nav-heading" :aria-expanded="isOpen"
     class="container flex flex-wrap items-center justify-between py-5" x-data="{ isOpen: false }"
     @keydown.escape="isOpen = false" @click.away="isOpen = false">
    <a aria-label="logo" href="https://s-panteleev.ru">
        <span class="font-bold text-xl lg:text-lg text-dark-purplish-blue">Сергей Пантелеев</span>
    </a>

    <button :aria-expanded="isOpen" aria-controls="nav-list" aria-label="toggle menu" @click="isOpen = !isOpen"
            type="button" class="block px-2 text-indigo-900 lg:hidden focus:outline-none">
        <svg class="w-8 h-8 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path x-show.transition="!isOpen"
                  d="M3 7h18a1 1 0 100-2H3a1 1 0 000 2zm18 10H3a1 1 0 000 2h18a1 1 0 000-2zm0-4H3a1 1 0 000 2h18a1 1 0 000-2zm0-4H3a1 1 0 000 2h18a1 1 0 000-2z"/>

            <path x-show="isOpen"
                  d="M13.41 12l6.3-6.29a1.004 1.004 0 00-1.42-1.42L12 10.59l-6.29-6.3a1.004 1.004 0 10-1.42 1.42l6.3 6.29-6.3 6.29a.999.999 0 000 1.42 1 1 0 001.42 0l6.29-6.3 6.29 6.3a1.001 1.001 0 001.639-.325 1 1 0 00-.22-1.095L13.41 12z"/>
        </svg>
    </button>

    <!--Menu-->
    <div class="flex-grow w-full lg:flex lg:items-center lg:w-auto hidden"
         :class="{ 'block': isOpen, 'hidden': !isOpen }">
        <ul id="nav-list"
            class="flex-wrap items-center justify-end flex-1 pt-6 space-y-5 lg:space-y-0 lg:pt-0 list-reset lg:flex lg:space-x-10">
            <li>
                <a class="text-xl font-medium lg:text-lg text-dark-purplish-blue hover:text-blue-500"
                   href="https://s-panteleev.ru/">Главная</a>
            </li>
            <li>
                <a class="text-xl font-medium lg:text-lg text-dark-purplish-blue hover:text-blue-500"
                   href="https://s-panteleev.ru/posts/">Статьи</a>
            </li>
            <li>
                <a class="text-xl font-medium lg:text-lg text-dark-purplish-blue hover:text-blue-500"
                   href="https://s-panteleev.ru/projects/">Проекты</a>
            </li>
            <li>
                <a class="text-xl font-medium lg:text-lg text-dark-purplish-blue hover:text-blue-500"
                   href="https://s-panteleev.ru/about/">Обо мне</a>
            </li>
        </ul>
    </div>
</nav>
<div class="container">
        <div class="container pb-16 md:pb-28">
        <div class="pt-8 md:pt-16 pb-4 md:pb-8">
            <h1 class="font-bold xl:text-6xl lg:text-5xl md:text-4xl text-3xl text-dark-purplish-blue text-center">
                Перечисления в PHP 8.1
            </h1>

            <div class="flex flex-row items-center my-8 space-x-1 md:space-x-4 justify-center">
                                                            <a href="/posts/tag/php"
       class="bg-dark-purplish-blue text-white px-2 py-1 rounded uppercase text-sm font-bold">PHP</a>
                                            <span class="bg-gray-100 text-gray-500 px-2 py-1 rounded uppercase text-sm font-bold">PHP 8.1</span>
                                    
                <p class="font-normal text-base text-gray-600">2 августа 2021 г.</p>
            </div>
        </div>

        <div class="h-64 md:h-96 mb-8">
            <img class="object-contain w-full h-full bg-dark-purplish-blue"
                 style="object-position: 50% 50%"
                 src="/assets/images/posts/php-81-enums/cover.jpg"
                 alt="Перечисления в PHP 8.1">
        </div>

        <div class="max-w-4xl">
                            <div class="w-full bg-gray-100 my-5 text-dark-purplish-blue">
                    <div class="container flex items-center justify-between px-6 py-4 mx-auto">
                        <div class="flex">
                            <span class="font-medium mr-1">Перевод статьи</span>
                            «<a href="https://stitcher.io/blog/php-enums"
                                rel="noreferrer noopener"
                                class="display-inline border-b border-gray-300 hover:border-transparent transition-all"
                                target="_blank">Enums in PHP 8.1</a>»
                        </div>
                    </div>
                </div>
            
            <div class="prose prose-lg text-gray-600 max-w-none mt-5">
                <p>Они наконец-то появятся: поддержка перечислений будет добавлена в PHP 8.1!
Пост посвящён более подробному рассмотрению нового функционала.</p>

<p>Начнём с того, как выглядят перечисления:</p>

<pre><code class="language-php">enum Status
{
    case DRAFT;
    case PUBLISHED;
    case ARCHIVED;
}
</code></pre>

<p>Преимущество перечислений заключается в том, что они представляют собой набор постоянных значений,
но, что наиболее важно, эти значения можно использовать следующим образом:</p>

<pre><code class="language-php">class BlogPost
{
    public function __construct(
        public Status $status,
    ) {}
}
</code></pre>

<p>В примере выше создание <code>BlogPost</code> и передача в него перечисления выглядит так:</p>

<pre><code class="language-php">$post = new BlogPost(Status::DRAFT);
</code></pre>

<p>Не будем останавливаться на основах, поскольку, как вы уже заметили, в этом нет ничего сложного.
Однако, есть ещё много дополнительных возможностей, давайте рассмотрим перечисления подробнее!</p>

<h2>Методы перечислений</h2>

<p>Перечисления могут определять методы, как и обычные классы. Это очень удобно, особенно в сочетании с оператором <code>match</code>:</p>

<pre><code class="language-php">enum Status
{
    case DRAFT;
    case PUBLISHED;
    case ARCHIVED;

    public function color(): string
    {
        return match($this) 
        {
            Status::DRAFT =&gt; 'grey',   
            Status::PUBLISHED =&gt; 'green',   
            Status::ARCHIVED =&gt; 'red',   
        };
    }
}
</code></pre>

<p>Методы можно использовать так:</p>

<pre><code class="language-php">$status = Status::ARCHIVED;

$status-&gt;color(); // 'red'
</code></pre>

<p>Также можно использовать статичные методы:</p>

<pre><code class="language-php">enum Status
{
    // …

    public static function make(): Status
    {
        // …
    }
}
</code></pre>

<p>И использовать в перечислениях <code>self</code>:</p>

<pre><code class="language-php">enum Status
{
    // …

    public function color(): string
    {
        return match($this) 
        {
            self::DRAFT =&gt; 'grey',   
            self::PUBLISHED =&gt; 'green',   
            self::ARCHIVED =&gt; 'red',   
        };
    }
}
</code></pre>

<h2>Перечисления и интерфейсы</h2>

<p>Также как и классы, перечисления могут реализовывать интерфейсы:</p>

<pre><code class="language-php">interface HasColor
{
    public function color(): string;
}

enum Status implements HasColor
{
    case DRAFT;
    case PUBLISHED;
    case ARCHIVED;

    public function color(): string { /* … */ }
}
</code></pre>

<h2>Значения перечислений</h2>

<p>Хотя перечисления являются объектами, вы можете присвоить им значения, если пожелаете;
это может быть полезно, например, для сохранения их в базу данных.</p>

<pre><code class="language-php">enum Status: string
{
    case DRAFT = 'draft';
    case PUBLISHED = 'published';
    case ARCHIVED = 'archived';
}
</code></pre>

<p>Обратите внимание на объявление типа в определении перечисления. Он указывает на то, что все значения перечисления относятся к указанному типу.
Вы также можете сделать его <code>int</code>. В качестве типа можно использовать только <code>int</code> или <code>string</code>.</p>

<pre><code class="language-php">enum Status: int
{
    case DRAFT = 1;
    case PUBLISHED = 2;
    case ARCHIVED = 3;
}
</code></pre>

<p>Если вы решите присвоить значения перечислениям, это будет необходимо сделать для всех вариантов,
также нельзя смешивать и совмещать типы.</p>

<h2>Типизированные перечисления с интерфейсами</h2>

<p>Если вы используете типизированные перечисления совместно с интерфейсами, тип должен стоять сразу после имени перечисления,
перед ключевым словом <code>implements</code>.</p>

<pre><code class="language-php">enum Status: string implements HasColor
{
    case DRAFT = 'draft';
    case PUBLISHED = 'published';
    case ARCHIVED = 'archived';

    // …
}
</code></pre>

<h2>Сериализация типизированных перечислений</h2>

<p>Если вы присваиваете значения вариантам перечислений, вам, вероятно, понадобится способ их сериализации и десериализации.
Под сериализацией подразумевается, что вам нужен способ получить значение перечисления. Это делается с помощью общедоступного readonly-свойства:</p>

<pre><code class="language-php">$value = Status::PUBLISHED-&gt;value; // 2
</code></pre>

<p>Для получения перечисления по значению можно использовать метод <code>Enum::from</code>:</p>

<pre><code class="language-php">$status = Status::from(2); // Status::PUBLISHED
</code></pre>

<p>Также существует метод <code>tryFrom</code>, который возвращает <code>null</code>, если передано неизвестное значение.
При использовании <code>from</code> в таком случае, будет выброшено исключение.</p>

<pre><code class="language-php">$status = Status::from('unknown'); // ValueError
$status = Status::tryFrom('unknown'); // null
</code></pre>

<p>Обратите внимание, вы можете использовать встроенные функции <code>serialize</code> и <code>unserialize</code> при работе c перечислениями.
Кроме того, вы можете использовать <code>json_encode</code> в сочетании с типизированными перечислениями, результатом выполнения функции будет значение перечисления.
Поведение можно переопределить, реализовав <code>JsonSerializable</code>.</p>

<h2>Вывод вариантов перечисления</h2>

<p>Чтобы получить список всех доступных вариантов перечисления, воспользуйтесь статичным методом <code>Enum::cases()</code>:</p>

<pre><code class="language-php">Status::cases();

/* [
Status::DRAFT,
Status::PUBLISHED,
Status::ARCHIVED
] */
</code></pre>

<p>Обратите внимание, что в массиве содержатся объекты перечислений:</p>

<pre><code class="language-php">array_map(
fn(Status $status) =&gt; $status-&gt;color(),
Status::cases()
);
</code></pre>

<h2>Перечисления — это объекты</h2>

<p>Я уже упоминал, что варианты перечислений являются объектами, на самом деле это одноэлементные объекты.
Вы можете сравнивать их следующим образом:</p>

<pre><code class="language-php">$statusA = Status::PENDING;
$statusB = Status::PENDING;
$statusC = Status::ARCHIVED;

$statusA === $statusB; // true
$statusA === $statusC; // false
$statusC instanceof Status; // true
</code></pre>

<h2>Перечисления как ключи массива</h2>

<p>Поскольку перечисления являются объектами, в настоящее время невозможно использовать их в качестве ключей массива.
Этот код приведёт к ошибке:</p>

<pre><code class="language-php">$list = [
Status::DRAFT =&gt; 'draft',
// …
];
</code></pre>

<p>В <a href="https://wiki.php.net/rfc/object_keys_in_arrays">RFC</a> от Никиты Попова предлагается изменение такого поведения, но он ещё не перешёл в стадию голосования.</p>

<p>Пока что вы можете использовать перечисления в качестве ключей только в <code>SplObjectStorage</code> и <code>WeakMaps</code>.</p>

<h2>Трейты</h2>

<p>Перечисления могут использовать трейты так же, как классы, но с некоторыми ограничениями:
нельзя переопределять встроенные методы перечислений, а также трейты не могут содержать свойства класса — в перечислениях свойства запрещены.</p>

<h2>Reflection и атрибуты</h2>

<p>Как и ожидалось, добавлено несколько Reflection-классов для работы с перечислениями:
<code>ReflectionEnum</code>, <code>ReflectionEnumUnitCase</code> и <code>ReflectionEnumBackedCase</code>. Также появилась новая функция <code>enum_exists</code>, название которой говорит само за себя.</p>

<p>Как и обычные классы и свойства, перечисления и их варианты можно аннотировать с помощью атрибутов. Обратите внимание, перечисления будут включены в фильтр <code>TARGET_CLASS</code>.</p>

<p>И последнее: у перечислений также есть readonly-свойство <code>$enum-&gt;name</code>, которое в RFC упоминается как часть реализации и, вероятно, должно использоваться только для отладки.
Однако об этом всё же стоит упомянуть.</p>

<p>Вот и всё, что можно сказать о перечислениях. Я с нетерпением жду возможности использовать их, как только выйдет PHP 8.1.</p>
            </div>
        </div>
    </div>
</div>

<footer class="body-font bg-dark-purplish-blue">
    <div class="container px-5 py-8 mx-auto flex items-center sm:flex-row flex-col">
        <p class="text-sm text-white sm:ml-4 sm:py-2 sm:mt-0 mt-4">
            © 2022 Сергей Пантелеев
        </p>
        <div class="inline-flex sm:ml-auto sm:mt-0 mt-4 justify-center sm:justify-start">
            <div class="icon-list-social">
    <a class="icon-list-social-link ml-3 text-white text-opacity-70 hover:text-opacity-100 transition-all"
       href="https://t.me/saundefined" rel="noopener noreferrer" target="_blank">
        <i class="fa-brands fa-telegram"></i>
    </a>
    <a class="icon-list-social-link ml-3 text-white text-opacity-70 hover:text-opacity-100 transition-all"
       href="https://vk.com/id261057243" rel="noopener noreferrer" target="_blank">
        <i class="fa-brands fa-vk"></i>
    </a>
    <a class="icon-list-social-link ml-3 text-white text-opacity-70 hover:text-opacity-100 transition-all"
       href="https://github.com/saundefined" rel="noopener noreferrer" target="_blank">
        <i class="fa-brands fa-github"></i>
    </a>
    <a class="icon-list-social-link ml-3 text-white text-opacity-70 hover:text-opacity-100 transition-all"
       href="https://twitter.com/s_panteleev" rel="noopener noreferrer" target="_blank">
        <i class="fa-brands fa-twitter"></i>
    </a>
</div>        </div>
    </div>
</footer>

<script src="https://plugins.jetbrains.com/assets/scripts/mp-widget.js"></script>
<script src="/assets/build/js/main.js"></script>
</body>
</html>
